<div class="card border-0 rounded shadow-sm p-3 m-5">
  <div class="row">
    <div class="col-lg-12 col-sm-12 col-md-12">
      <mat-form-field class="full-width" appearance="fill">
        <mat-label>Buscar por registros</mat-label>
        <input matInput (input)="onChange($event)" placeholder="" />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      <div class="col-lg-4 col-sm-12 col-md-12 col-12">
        <button class="btn btn-success mb-1 me-2 tamanho-fonte" *ngIf="ehAdministrador" (click)="exportarParaExcel()">
          <i class="fas fa-file-excel my-1" id="icone-excel"></i>
          Excel
        </button>
        <button class="btn btn-outline-primary mb-1 ml-1 mr-1" routerLink="/dashboard/permissao">
          <b class="ml-1 mr-1 tamanho-fonte">
            Novo
            <i class="fa fa-plus-circle my-1"></i>
          </b>
        </button>
      </div>
    </div>
  </div>
  <ngx-table
    [data]="data"
    [configuration]="configuracao"
    [columns]="colunas"
    [noResultsTemplate]="mensagemSemCadastro"
    [summaryTemplate]="summaryTemplateRef"
    [detailsTemplate]="detailsTemplate"
    #table
  >
    <ng-template let-row let-index="index">
      <td *ngIf="!isMobile">
        <div class="font-small">{{ row.codigoPerfil }}</div>
      </td>
      <td>
        <div class="font-small">{{ row.descricaoPerfil }}</div>
      </td>
      <td *ngIf="!isMobile">
        <div class="font-small">{{ row.ativo | booleano : true }}</div>
      </td>
      <td *ngIf="isMobile">
        <button class="btn botao-expandir" id="expandButton-{{ index }}" (click)="onRowClickEvent($event, index)">
          <i class="fa fa-arrow-left" *ngIf="!toggledRows.has(index)"></i>
          <i class="fa fa-arrow-down" *ngIf="toggledRows.has(index)"></i>
          Expandir
        </button>
      </td>
      <td *ngIf="!isMobile">
        <button
          title="Botão para editar registro"
          class="btn botao-alterar btn-lg"
          (click)="detalhePermissao(row.codigoPerfil)"
        >
          <i class="fa fa-edit"></i>
        </button>
      </td>
      <td *ngIf="!isMobile">
        <button
          title="Botão para desativar permissão"
          class="btn botao-excluir btn-lg"
          (click)="abrirModal($event, template, row.codigoPerfil)"
        >
          <i class="fa fa-ban" aria-hidden="true"></i>
        </button>
      </td>
    </ng-template>
  </ngx-table>
</div>
<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-spin-fade" [fullScreen]="true">
  <p style="color: white">Buscando...</p>
</ngx-spinner>

<ng-template #template>
  <div class="modal-body text-center">
    <p class="tamanho-fonte">
      Deseja confirmar a
      <strong>desativação</strong>
      da permissão de código {{ permissaoId }}?
    </p>
    <button type="button" class="btn btn-default" (click)="confirmar()">Sim</button>
    <button type="button" class="btn btn-primary" (click)="recusar()">Não</button>
  </div>
</ng-template>
<ng-template #mensagemSemCadastro>
  <td [attr.colspan]="colunas.length + 1" class="no-results text-center">
    <h4>Não há nenhuma permissão cadastrada</h4>
  </td>
</ng-template>

<ng-template #summaryTemplateRef let-total="total">
  <th>Total de registros: {{ total }}</th>
</ng-template>

<ng-template #detailsTemplate let-row>
  <p class="font-small">Código: {{ row.codigoPerfil }}</p>
  <p class="font-small">Situação: {{ row.ativo | booleano : true }}</p>
  <button
    title="Botão para editar registro"
    class="btn botao-alterar btn-lg mr-3"
    (click)="detalhePermissao(row.codigoPerfil)"
  >
    <i class="fa fa-edit"></i>
  </button>
  <button
    title="Botão para desativar permissão"
    class="btn botao-excluir btn-lg"
    (click)="abrirModal($event, template, row.codigoPerfil)"
  >
    <i class="fa fa-ban" aria-hidden="true"></i>
  </button>
</ng-template>
<ngx-spinner
  name="buscando"
  [bdColor]="confSpinner.bdColor"
  [size]="confSpinner.tamanho"
  [color]="confSpinner.color"
  [fullScreen]="confSpinner.fullScren"
>
  <p style="color: white">Buscando...</p>
</ngx-spinner>
<ngx-spinner
  name="desativando"
  [bdColor]="confSpinner.bdColor"
  [size]="confSpinner.tamanho"
  [color]="confSpinner.color"
  [fullScreen]="confSpinner.fullScren"
>
  <p style="color: white">Desativando...</p>
</ngx-spinner>
